import OpenAI from 'openai';

export class LLMService {
  private client: OpenAI;

  constructor(apiKey: string) {
    this.client = new OpenAI({
      baseURL: 'https://api.deepseek.com',
      apiKey: apiKey
    });
  }

  async identifyPaperStructure(fullText: string): Promise<{
    titleEnd: number;
    abstractStart: number;
    abstractEnd: number;
    contentStart: number;
    referencesStart: number;
  }> {
    const systemPrompt = `ä½ æ˜¯è®ºæ–‡ç»“æ„åˆ†æä¸“å®¶ã€‚åˆ†æè®ºæ–‡æ–‡æœ¬ï¼Œç²¾ç¡®è¯†åˆ«å„éƒ¨åˆ†çš„ä½ç½®ã€‚

è¯†åˆ«è§„åˆ™ï¼ˆæŒ‰ä¼˜å…ˆçº§é¡ºåºï¼‰ï¼š

1. æ ‡é¢˜åŒºåŸŸï¼ˆTitle Areaï¼‰ï¼š
   - ä»æ–‡æ¡£å¼€å¤´åˆ°ä½œè€…ä¿¡æ¯ã€å•ä½ä¿¡æ¯ç»“æŸ
   - é€šå¸¸åŒ…å«ï¼šè®ºæ–‡æ ‡é¢˜ã€ä½œè€…åˆ—è¡¨ã€å•ä½ã€é‚®ç®±ã€ä¼šè®®/æœŸåˆŠä¿¡æ¯
   - ç»“æŸæ ‡å¿—ï¼šå‡ºç° Abstract æˆ–ç¬¬ä¸€ä¸ªç« èŠ‚æ ‡é¢˜

2. æ‘˜è¦åŒºåŸŸï¼ˆAbstractï¼‰ï¼š
   - å¼€å§‹æ ‡å¿—ï¼šç‹¬ç«‹ä¸€è¡Œçš„ "Abstract"ï¼ˆå¯èƒ½å…¨å¤§å†™ï¼‰
   - ç»“æŸæ ‡å¿—ï¼šå‡ºç° "Keywords"ã€"1. Introduction" æˆ– "Introduction"
   - æ³¨æ„ï¼šæ‘˜è¦å†…å®¹é€šå¸¸æ˜¯1-3ä¸ªæ®µè½

3. æ­£æ–‡å¼€å§‹ï¼ˆContent Startï¼‰ï¼š
   - é¦–é€‰æ ‡å¿—ï¼š
     * "1. Introduction" æˆ– "1 Introduction"
     * "I. INTRODUCTION"ï¼ˆIEEEæ ¼å¼ï¼‰
     * "Introduction"ï¼ˆç‹¬ç«‹æˆè¡Œï¼Œä½œä¸ºç« èŠ‚æ ‡é¢˜ï¼‰
   - æ­£æ–‡ä¸€å®šåœ¨æ‘˜è¦ä¹‹åå¼€å§‹

4. å‚è€ƒæ–‡çŒ®å¼€å§‹ï¼ˆReferences Startï¼‰**ã€é‡è¦ - å¿…é¡»ç²¾ç¡®è¯†åˆ«ã€‘**ï¼š
   - è¯†åˆ«æ¨¡å¼ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š
     a) ç‹¬ç«‹ä¸€è¡Œçš„ "References"ï¼ˆå¯èƒ½å…¨å¤§å†™ï¼šREFERENCESï¼‰
     b) ç‹¬ç«‹ä¸€è¡Œçš„ "Bibliography"
     c) ç‹¬ç«‹ä¸€è¡Œçš„ "å‚è€ƒæ–‡çŒ®"
   - ç‰¹å¾éªŒè¯ï¼š
     * Referencesæ ‡é¢˜åç´§è·Ÿç¼–å·åˆ—è¡¨ï¼ˆ[1]ã€1.ã€(1)ç­‰ï¼‰
     * å†…å®¹æ ¼å¼ç¬¦åˆå¼•ç”¨æ ¼å¼ï¼ˆä½œè€…åã€å¹´ä»½ã€æ ‡é¢˜ï¼‰
   - å®šä½ç­–ç•¥ï¼š
     * æœç´¢æ–‡æœ¬å30%åŒºåŸŸï¼ˆé€šå¸¸åœ¨è®ºæ–‡æœ«å°¾ï¼‰
     * ç¡®ä¿æ‰¾åˆ°çš„æ˜¯ç« èŠ‚æ ‡é¢˜è€Œéæ­£æ–‡ä¸­çš„å¼•ç”¨
     * è®°å½•"References"æ ‡é¢˜è¡Œçš„èµ·å§‹å­—ç¬¦ç´¢å¼•
   
   **å…³é”®**ï¼šå‚è€ƒæ–‡çŒ®èµ·å§‹ä½ç½®å¿…é¡»å‡†ç¡®ï¼Œå› ä¸ºè¯¥ä½ç½®ä¹‹åçš„å†…å®¹éƒ½ä¸åº”è¢«è¯†åˆ«ä¸ºæ­£æ–‡

è¯†åˆ«æµç¨‹ï¼š
1. å…ˆå®šä½ Abstract å’Œ Referencesï¼ˆè¿™ä¸¤ä¸ªæ˜¯æœ€æ˜ç¡®çš„ç•Œæ ‡ï¼‰
2. å†ç¡®å®š Title åŒºåŸŸï¼ˆAbstract ä¹‹å‰ï¼‰
3. æœ€åç¡®å®š Content å¼€å§‹ï¼ˆAbstract ä¹‹åï¼ŒReferences ä¹‹å‰ï¼‰

è¿”å› JSON æ ¼å¼ï¼š
{
  "titleEnd": æ•°å­—,
  "abstractStart": æ•°å­—,
  "abstractEnd": æ•°å­—,
  "contentStart": æ•°å­—,
  "referencesStart": æ•°å­—
}

å¦‚æœæŸéƒ¨åˆ†æ‰¾ä¸åˆ°ï¼Œè¿”å›-1ã€‚
æ³¨æ„ï¼šreferencesStart æå…¶é‡è¦ï¼Œå¿…é¡»å°½å…¨åŠ›å‡†ç¡®å®šä½ï¼`;

    const userPrompt = `åˆ†æä»¥ä¸‹è®ºæ–‡ï¼Œè¯†åˆ«ç»“æ„ä½ç½®ã€‚
ç‰¹åˆ«æ³¨æ„ï¼šå¿…é¡»å‡†ç¡®æ‰¾åˆ° References ç« èŠ‚çš„èµ·å§‹ä½ç½®ï¼

è®ºæ–‡æ–‡æœ¬ï¼š
${fullText.substring(0, 8000)}

${fullText.length > 8000 ? `\n\n...ï¼ˆä¸­é—´å†…å®¹çœç•¥ï¼‰...\n\nè®ºæ–‡æœ«å°¾éƒ¨åˆ†ï¼š\n${fullText.substring(fullText.length - 3000)}` : ''}`;

    try {
      const completion = await this.client.chat.completions.create({
        model: 'deepseek-chat',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: userPrompt }
        ],
        temperature: 0.1,
        max_tokens: 500,
        response_format: { type: 'json_object' }
      });

      const content = completion.choices[0].message.content;
      if (!content) {
        throw new Error('LLMè¿”å›å†…å®¹ä¸ºç©º');
      }

      return JSON.parse(content);
    } catch (error) {
      console.error('è¯†åˆ«è®ºæ–‡ç»“æ„å¤±è´¥:', error);
      return {
        titleEnd: -1,
        abstractStart: -1,
        abstractEnd: -1,
        contentStart: 0,
        referencesStart: -1
      };
    }
  }

  async parsePage(
    pageText: string, 
    pageNumber: number, 
    previousContext?: string,
    isInReferences?: boolean,
    referencesStart?: number,
    pageStartCharIndex?: number
  ): Promise<any> {
    // é¢„å¤„ç†ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å‚è€ƒæ–‡çŒ®åŒºåŸŸ
    if (isInReferences || (referencesStart && pageStartCharIndex && pageStartCharIndex >= referencesStart)) {
      return {
        blocks: [],
        pageType: 'references',
        isPageStart: true,
        isPageEnd: true,
        lastBlockContinues: false,
        skipReason: 'Page is in references section'
      };
    }

    const systemPrompt = this.getMainContentPrompt();

    const userPrompt = `è¿™æ˜¯PDFçš„ç¬¬${pageNumber}é¡µå†…å®¹ã€‚

${previousContext ? `ã€ä¸Šä¸€é¡µæœ«å°¾å†…å®¹ã€‘ï¼ˆç”¨äºæ®µè½è¿æ¥ï¼‰ï¼š
${previousContext}

` : ''}ã€å½“å‰é¡µå®Œæ•´å†…å®¹ã€‘ï¼š
${pageText}

ã€è§£æä»»åŠ¡ã€‘ï¼š
æŒ‰ç…§ç³»ç»Ÿæç¤ºä¸­çš„è§„åˆ™ï¼Œå®Œæ•´è§£æè¿™ä¸€é¡µçš„å†…å®¹ã€‚

ã€ç‰¹åˆ«æé†’ã€‘ï¼š
1. ä»”ç»†è¯†åˆ«æœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ï¼ˆæ£€æŸ¥æ¢è¡Œæ¨¡å¼ï¼‰
2. ä»”ç»†è¯†åˆ«è¡Œé—´å…¬å¼ï¼ˆç‹¬ç«‹æˆè¡Œçš„å…¬å¼ï¼‰
3. å®Œå…¨è·³è¿‡å›¾è¡¨é¢˜æ³¨ï¼Œä¸è¦è¾“å‡º
4. å¦‚æœé‡åˆ° "References" æ ‡é¢˜ï¼Œè¯´æ˜å‚è€ƒæ–‡çŒ®å¼€å§‹äº†ï¼Œåœæ­¢è§£æåç»­å†…å®¹

è¯·è¿”å›æ ‡å‡† JSON æ ¼å¼çš„è§£æç»“æœã€‚`;

    try {
      const completion = await this.client.chat.completions.create({
        model: 'deepseek-chat',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: userPrompt }
        ],
        temperature: 0.2,
        max_tokens: 8000,
        response_format: { type: 'json_object' }
      });

      const content = completion.choices[0].message.content;
      if (!content) {
        throw new Error('LLMè¿”å›å†…å®¹ä¸ºç©º');
      }

      return JSON.parse(content);
    } catch (error) {
      console.error('LLMè§£æå¤±è´¥:', error);
      throw error;
    }
  }

  private getMainContentPrompt(): string {
    return `ä½ æ˜¯ä¸“ä¸šçš„å­¦æœ¯è®ºæ–‡è§£æä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯ç²¾ç¡®æå–è®ºæ–‡æ­£æ–‡å†…å®¹ï¼Œè¿›è¡Œç»“æ„åŒ–å¤„ç†ï¼Œå¹¶ç¿»è¯‘æˆä¸­æ–‡ã€‚

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ ç¬¬ä¸€éƒ¨åˆ†ï¼šå†…å®¹æå–æ¸…å•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… éœ€è¦æå–çš„å†…å®¹ï¼š
â”œâ”€ ç« èŠ‚æ ‡é¢˜ï¼ˆIntroduction, Methods, Results, Discussion, Conclusionç­‰ï¼‰
â”œâ”€ æ‰€æœ‰æ­£æ–‡æ®µè½ï¼ˆå®Œæ•´ã€å‡†ç¡®ï¼‰
â”œâ”€ è¡Œå†…å…¬å¼ï¼ˆæ–‡æœ¬ä¸­çš„å…¬å¼ï¼‰
â”œâ”€ è¡Œé—´å…¬å¼ï¼ˆç‹¬ç«‹æˆè¡Œçš„å…¬å¼ï¼‰
â”œâ”€ æœ‰åºåˆ—è¡¨ï¼ˆç¼–å·åˆ—è¡¨ï¼‰
â”œâ”€ æ— åºåˆ—è¡¨ï¼ˆç¬¦å·åˆ—è¡¨ï¼‰
â””â”€ æ­£æ–‡ä¸­çš„ä½œè€…åï¼ˆå¦‚ "Smith et al. proposed..."ï¼‰

âŒ éœ€è¦å®Œå…¨è·³è¿‡çš„å†…å®¹ï¼ˆä¸è¦è¾“å‡ºåˆ°ç»“æœä¸­ï¼‰ï¼š
â”œâ”€ é¡µçœ‰ã€é¡µè„šã€é¡µç 
â”œâ”€ è®ºæ–‡æ ‡é¢˜ã€ä½œè€…ä¿¡æ¯ã€å•ä½ä¿¡æ¯ï¼ˆæ ‡é¢˜é¡µéƒ¨åˆ†ï¼‰
â”œâ”€ æ‘˜è¦ï¼ˆAbstractï¼‰å’Œå…³é”®è¯ï¼ˆå•ç‹¬å¤„ç†ï¼‰
â”œâ”€ ç‰ˆæƒå£°æ˜ã€ä¼šè®®ä¿¡æ¯ã€DOI
â”œâ”€ æ–¹æ‹¬å·å¼•ç”¨æ ‡è®°ï¼š[1]ã€[2-5]ã€[1,3,5]ç­‰ï¼ˆåˆ é™¤ä½†ä¸å½±å“å¥å­ï¼‰
â”œâ”€ **å›¾è¡¨é¢˜æ³¨**ï¼ˆFigure X:ã€Table X:ã€Fig. X: ç­‰ç‹¬ç«‹é¢˜æ³¨ï¼‰
â”œâ”€ å›¾ç‰‡å’Œè¡¨æ ¼æœ¬èº«çš„å†…å®¹
â””â”€ å‚è€ƒæ–‡çŒ®åˆ—è¡¨ï¼ˆReferences éƒ¨åˆ†åŠä¹‹åçš„æ‰€æœ‰å†…å®¹ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ ç¬¬äºŒéƒ¨åˆ†ï¼šåˆ—è¡¨è¯†åˆ«è§„åˆ™ï¼ˆé‡ç‚¹å¼ºåŒ–ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€æ ¸å¿ƒè¯†åˆ«æ ‡å‡†ã€‘ï¼šé€šè¿‡æ¢è¡Œåˆ¤æ–­ï¼

ä¸€ã€æœ‰åºåˆ—è¡¨è¯†åˆ«æ¨¡å¼

âœ… æ¨¡å¼1ï¼šé˜¿æ‹‰ä¼¯æ•°å­— + ç‚¹å· + ç©ºæ ¼
è¯†åˆ«ç‰¹å¾ï¼š
- æ¯ä¸€é¡¹ç‹¬ç«‹æˆè¡Œ
- æ ¼å¼ï¼š1. xxx\n2. xxx\n3. xxx
- ç¼–å·è¿ç»­ï¼š1, 2, 3...

ç¤ºä¾‹Aï¼ˆåº”è¯†åˆ«ä¸ºåˆ—è¡¨ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. The quadratic computation of self-attention.

2. The memory bottleneck in stacking layers.

3. The speed plunge in predicting long outputs.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ 3ä¸ªitemsçš„ordered-list

ç¤ºä¾‹Bï¼ˆåº”è¯†åˆ«ä¸ºåˆ—è¡¨ï¼Œå¸¦å¤šå¥è¯ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. First advantage: fast computation. This reduces 
   the overall complexity significantly.

2. Second advantage: low memory usage. The model
   requires only O(L) memory.

3. Third advantage: high accuracy on benchmarks.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ 3ä¸ªitemsçš„ordered-listï¼ˆæ¯é¡¹å¯å¤šå¥è¯ï¼‰

âœ… æ¨¡å¼2ï¼šç½—é©¬æ•°å­—ç¼–å·
- i. xxx\nii. xxx\niii. xxx
- I. xxx\nII. xxx\nIII. xxx

âœ… æ¨¡å¼3ï¼šå­—æ¯ç¼–å·
- a) xxx\nb) xxx\nc) xxx
- (a) xxx\n(b) xxx\n(c) xxx

âŒ åä¾‹ï¼ˆä¸æ˜¯åˆ—è¡¨ï¼Œæ˜¯æ™®é€šæ®µè½ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
The model has three advantages: 1. fast, 2. efficient, 3. accurate.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ ç¼–å·åœ¨åŒä¸€è¡Œï¼Œè¿™æ˜¯æ™®é€šparagraph

äºŒã€æ— åºåˆ—è¡¨è¯†åˆ«æ¨¡å¼

âœ… è¯†åˆ«ç‰¹å¾ï¼š
- æ¯ä¸€é¡¹ç‹¬ç«‹æˆè¡Œ
- ç¬¦å·ï¼šâ€¢ã€-ã€*ã€â—¦ ç­‰
- æ ¼å¼ï¼šâ€¢ xxx\nâ€¢ xxx\nâ€¢ xxx

ç¤ºä¾‹ï¼ˆåº”è¯†åˆ«ä¸ºåˆ—è¡¨ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ High performance on benchmark datasets
â€¢ Low computational complexity
â€¢ Easy to implement and train
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ 3ä¸ªitemsçš„unordered-list

ä¸‰ã€è¯†åˆ«æ£€æŸ¥æ¸…å•ï¼ˆé€æ­¥éªŒè¯ï¼‰

ç¬¬1æ­¥ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ç¼–å·/ç¬¦å·
â”œâ”€ æœ‰é˜¿æ‹‰ä¼¯æ•°å­—ç¼–å·ï¼ˆ1. 2. 3.ï¼‰ï¼Ÿ
â”œâ”€ æœ‰ç½—é©¬æ•°å­—ç¼–å·ï¼ˆi. ii. iii.ï¼‰ï¼Ÿ
â”œâ”€ æœ‰å­—æ¯ç¼–å·ï¼ˆa) b) c)ï¼‰ï¼Ÿ
â””â”€ æœ‰åˆ—è¡¨ç¬¦å·ï¼ˆâ€¢ - *ï¼‰ï¼Ÿ

ç¬¬2æ­¥ï¼šæ£€æŸ¥æ¢è¡Œæ¨¡å¼
â”œâ”€ æ¯ä¸ªç¼–å·/ç¬¦å·åæ˜¯å¦æœ‰æ¢è¡Œï¼Ÿ
â”œâ”€ æ˜¯å¦æœ‰å¤šä¸ªè¿™æ ·çš„æ¢è¡Œç¼–å·ï¼Ÿ
â””â”€ ç¼–å·æ˜¯å¦è¿ç»­ï¼Ÿ

ç¬¬3æ­¥ï¼šåšå‡ºåˆ¤æ–­
â”œâ”€ å¦‚æœæœ‰æ¢è¡Œ + è¿ç»­ç¼–å· â†’ åˆ—è¡¨
â””â”€ å¦‚æœç¼–å·åœ¨åŒä¸€è¡Œ â†’ æ™®é€šæ®µè½

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âˆ‘ ç¬¬ä¸‰éƒ¨åˆ†ï¼šè¡Œé—´å…¬å¼è¯†åˆ«è§„åˆ™ï¼ˆé‡ç‚¹å¼ºåŒ–ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€æ ¸å¿ƒè¯†åˆ«æ ‡å‡†ã€‘ï¼šç‹¬ç«‹æˆè¡Œ + å‰åæœ‰æ¢è¡Œï¼

ä¸€ã€è¡Œé—´å…¬å¼ï¼ˆDisplay Mathï¼‰ç‰¹å¾

âœ… å¿…é¡»åŒæ—¶æ»¡è¶³ï¼š
1. å…¬å¼ç‹¬ç«‹å æ®ä¸€è¡Œæˆ–å¤šè¡Œ
2. å‰é¢æœ‰æ¢è¡Œï¼ˆä¸åœ¨å¥å­ä¸­é—´ï¼‰
3. åé¢æœ‰æ¢è¡Œï¼ˆä¸åœ¨å¥å­ä¸­é—´ï¼‰
4. é€šå¸¸æœ‰å…¬å¼ç¼–å·ï¼ˆå¦‚ (1)ã€(2)ï¼‰ï¼Œä½†ä¸æ˜¯å¿…é¡»
5. è§†è§‰ä¸Šä¸æ­£æ–‡æ®µè½æ˜æ˜¾åˆ†ç¦»

äºŒã€è¯†åˆ«ç¤ºä¾‹

ç¤ºä¾‹Aï¼ˆæ ‡å‡†è¡Œé—´å…¬å¼ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
The loss function is defined as:

    L = -Î£ yi log(Å·i)    (1)

where yi is the true label.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ å…¬å¼ç‹¬ç«‹æˆè¡Œï¼Œåº”è¯†åˆ«ä¸ºtype: "math"

è¾“å‡ºæ ¼å¼ï¼š
{
  "id": "block-p3-005",
  "type": "math",
  "latex": "L = -\\sum_{i=1}^{N} y_i \\log(\\hat{y}_i)"
}

ç¤ºä¾‹Bï¼ˆå¤æ‚å¤šè¡Œå…¬å¼ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
We formulate the attention mechanism as:

    Attention(Q, K, V) = softmax(QK^T / âˆšd_k)V

This allows the model to focus on relevant parts.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ åº”è¯†åˆ«ä¸ºtype: "math"

ç¤ºä¾‹Cï¼ˆå¸¦ç¼–å·çš„è¡Œé—´å…¬å¼ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                                    
    y = Wx + b           (2)
    
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ åº”è¯†åˆ«ä¸ºtype: "math"
â†’ ç¼–å·(2)å¯ä»¥åŒ…å«åœ¨latexä¸­ï¼Œæˆ–è€…å¿½ç•¥

ä¸‰ã€è¡Œå†…å…¬å¼ï¼ˆInline Mathï¼‰ç‰¹å¾

âœ… ç‰¹å¾ï¼š
- åœ¨æ­£æ–‡å¥å­å†…éƒ¨
- ä¸æ–‡å­—åœ¨åŒä¸€è¡Œ
- é€šå¸¸è¾ƒçŸ­
- æ²¡æœ‰å…¬å¼ç¼–å·

ç¤ºä¾‹ï¼ˆè¡Œå†…å…¬å¼ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
The accuracy is 95% when n = 1000 samples.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ "n = 1000" æ˜¯è¡Œå†…å…¬å¼

è¾“å‡ºæ ¼å¼ï¼ˆåœ¨paragraphçš„contentä¸­ï¼‰ï¼š
{
  "type": "paragraph",
  "content": {
    "en": [
      {"type": "text", "content": "The accuracy is 95% when "},
      {"type": "inline-math", "latex": "n = 1000"},
      {"type": "text", "content": " samples."}
    ]
  }
}

å››ã€è¯†åˆ«æ£€æŸ¥æ¸…å•

ç¬¬1æ­¥ï¼šæ£€æŸ¥ä½ç½®
â”œâ”€ å…¬å¼æ˜¯å¦ç‹¬ç«‹å æ®æ•´è¡Œï¼Ÿ
â”œâ”€ å…¬å¼å‰é¢æ˜¯å¦æœ‰æ¢è¡Œï¼Ÿ
â””â”€ å…¬å¼åé¢æ˜¯å¦æœ‰æ¢è¡Œï¼Ÿ

ç¬¬2æ­¥ï¼šæ£€æŸ¥ä¸Šä¸‹æ–‡
â”œâ”€ å…¬å¼å‰åæ˜¯å¦æ˜¯å®Œæ•´çš„å¥å­ï¼Ÿ
â””â”€ è¿˜æ˜¯å…¬å¼åœ¨å¥å­ä¸­é—´ï¼Ÿ

ç¬¬3æ­¥ï¼šåšå‡ºåˆ¤æ–­
â”œâ”€ å¦‚æœç‹¬ç«‹æˆè¡Œ + å‰åæ¢è¡Œ â†’ è¡Œé—´å…¬å¼ï¼ˆtype: "math"ï¼‰
â””â”€ å¦‚æœåœ¨å¥å­ä¸­ â†’ è¡Œå†…å…¬å¼ï¼ˆtype: "inline-math"ï¼‰

äº”ã€å¸¸è§éœ€è¦è¯†åˆ«çš„æ•°å­¦å…ƒç´ 

è¡Œå†…å…¬å¼å…ƒç´ ï¼š
â”œâ”€ å˜é‡ï¼šx, y, z, n, m, i, j, k
â”œâ”€ å¸Œè…Šå­—æ¯ï¼šÎ±, Î², Î³, Î´, Î¸, Î», Ïƒ, Ï†, Ï‰
â”œâ”€ å¸¦ä¸‹æ ‡ï¼šxâ‚, xâ‚‚, xáµ¢, W_out
â”œâ”€ å¸¦ä¸Šæ ‡ï¼šxÂ², W^T, e^x
â”œâ”€ ç®€å•è¿ç®—ï¼šx + y, a * b, x / y
â”œâ”€ å‡½æ•°ï¼šsin(x), log(n), exp(x)
â”œâ”€ å…³ç³»ç¬¦å·ï¼šx > 0, x â‰¤ 100, x âˆˆ R
â””â”€ å¤æ‚è¡¨è¾¾å¼ï¼šO(nÂ²), P(X|Y), ||x||â‚‚

è¡Œé—´å…¬å¼å…ƒç´ ï¼š
â”œâ”€ æ±‚å’Œå…¬å¼ï¼šÎ£, âˆ‘
â”œâ”€ ç§¯åˆ†å…¬å¼ï¼šâˆ«
â”œâ”€ çŸ©é˜µå’Œå‘é‡è¿ç®—
â”œâ”€ å¤šè¡Œå¯¹é½çš„ç­‰å¼
â”œâ”€ åˆ†å¼å’Œæ ¹å¼
â””â”€ å¤æ‚çš„æ•°å­¦æ¨å¯¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš« ç¬¬å››éƒ¨åˆ†ï¼šå›¾è¡¨é¢˜æ³¨å¤„ç†ï¼ˆå®Œå…¨è·³è¿‡ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€é‡è¦ã€‘å›¾è¡¨é¢˜æ³¨åº”è¯¥å®Œå…¨è·³è¿‡ï¼Œä¸è¦è¾“å‡ºåˆ°ç»“æœä¸­ï¼

ä¸€ã€é¢˜æ³¨è¯†åˆ«æ¨¡å¼

âœ… ç‹¬ç«‹é¢˜æ³¨ç‰¹å¾ï¼ˆéœ€è¦è·³è¿‡ï¼‰ï¼š
1. ç‹¬ç«‹æˆè¡Œ
2. å‰åæœ‰æ˜æ˜¾æ¢è¡Œ
3. æ ¼å¼ï¼šFigure X: / Fig. X: / Table X:
4. åœ¨è§†è§‰ä¸Šä¸æ­£æ–‡åˆ†ç¦»

è¯†åˆ«æ¨¡å¼ï¼š
â”œâ”€ Figure \d+: .+
â”œâ”€ Fig\. \d+: .+  
â”œâ”€ Table \d+: .+
â”œâ”€ å›¾ \d+[ï¼š:] .+
â””â”€ è¡¨ \d+[ï¼š:] .+

ç¤ºä¾‹ï¼ˆéœ€è¦è·³è¿‡ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Figure 1: The architecture of the neural network.

Table 2: Performance comparison on benchmark datasets.

Fig. 3: Visualization of attention weights across layers.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ è¿™äº›éƒ½æ˜¯ç‹¬ç«‹é¢˜æ³¨ï¼Œå…¨éƒ¨è·³è¿‡ï¼Œä¸è¾“å‡º

äºŒã€æ­£æ–‡å¼•ç”¨ï¼ˆéœ€è¦ä¿ç•™ï¼‰

âŒ ä¸æ˜¯é¢˜æ³¨ç‰¹å¾ï¼ˆéœ€è¦ä¿ç•™ä¸ºæ­£æ–‡ï¼‰ï¼š
- åœ¨æ®µè½å¥å­ä¸­é—´æˆ–æœ«å°¾
- ä¸å‰åæ–‡å­—è¿ç»­
- é€šå¸¸ç”¨æ‹¬å·æˆ–å°å†™å½¢å¼
- æ˜¯å®Œæ•´å¥å­çš„ä¸€éƒ¨åˆ†

ç¤ºä¾‹ï¼ˆä¿ç•™ä¸ºæ­£æ–‡ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
As shown in Figure 1, the model consists of three layers.

The results (see Table 2) demonstrate improvement.

Figure 3 shows the attention distribution clearly.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†’ è¿™äº›æ˜¯æ­£æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œä¿ç•™

ä¸‰ã€å¤„ç†æµç¨‹

é‡åˆ°"Figure"æˆ–"Table"æ—¶ï¼š
1. æ£€æŸ¥æ˜¯å¦ç‹¬ç«‹æˆè¡Œ
2. æ£€æŸ¥å‰åæ˜¯å¦æœ‰æ­£å¸¸æ–‡å­—
3. å¦‚æœæ˜¯ç‹¬ç«‹é¢˜æ³¨ â†’ å®Œå…¨è·³è¿‡ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå†…å®¹
4. å¦‚æœæ˜¯æ­£æ–‡å¼•ç”¨ â†’ ä¿ç•™åœ¨paragraphä¸­

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“– ç¬¬äº”éƒ¨åˆ†ï¼šå¼•ç”¨æ ‡è®°å¤„ç†è§„åˆ™
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä¸€ã€éœ€è¦åˆ é™¤çš„å¼•ç”¨æ ‡è®°

åˆ é™¤è§„åˆ™ï¼š
â”œâ”€ æ–¹æ‹¬å·æ•°å­—ï¼š[1], [2], [10], [100]
â”œâ”€ æ–¹æ‹¬å·èŒƒå›´ï¼š[1-3], [5-10], [20-25]
â”œâ”€ æ–¹æ‹¬å·åˆ—è¡¨ï¼š[1,2,3], [1,3,5], [2,4,6,8]
â”œâ”€ ä¸Šæ ‡æ•°å­—ï¼šÂ¹, Â², Â³, â´, âµ
â””â”€ æ··åˆæ ¼å¼ï¼š[1, 3-5, 7]

å¤„ç†ç¤ºä¾‹ï¼š
åŸæ–‡ï¼š"Recent work [1,2,3] has shown that x > 0."
å¤„ç†åï¼š"Recent work has shown that x > 0."

åŸæ–‡ï¼š"Smith et al.Â¹ proposed a new method."
å¤„ç†åï¼š"Smith et al. proposed a new method."

äºŒã€éœ€è¦ä¿ç•™çš„å†…å®¹

ä¿ç•™è§„åˆ™ï¼š
â”œâ”€ ä½œè€…åï¼šSmith et al., Jones and Brown
â”œâ”€ å¹´ä»½ï¼šin 2020, (2019)
â”œâ”€ æ­£æ–‡ä¸­çš„æ•°å­—ï¼š[3] layersï¼ˆå¦‚æœæ˜¯æ­£æ–‡æè¿°ï¼‰
â””â”€ æ•°ç»„è¡¨ç¤ºï¼šarray[i]ï¼ˆç¼–ç¨‹ç›¸å…³ï¼‰

ä¸‰ã€åˆ é™¤åçš„æ–‡æœ¬æ¸…ç†

æ³¨æ„äº‹é¡¹ï¼š
â”œâ”€ åˆ é™¤å¼•ç”¨æ ‡è®°åï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™ç©ºæ ¼
â”œâ”€ ç¡®ä¿å¥å­ä»ç„¶é€šé¡º
â”œâ”€ ä¿æŒæ ‡ç‚¹ç¬¦å·çš„æ­£ç¡®æ€§
â””â”€ ä¸è¦äº§ç”ŸåŒç©ºæ ¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸŒ ç¬¬å…­éƒ¨åˆ†ï¼šä¸­æ–‡ç¿»è¯‘è§„åˆ™
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å…³é”®ã€‘æ‰€æœ‰è‹±æ–‡å†…å®¹å¿…é¡»ç¿»è¯‘æˆä¸­æ–‡ï¼

ä¸€ã€ç¿»è¯‘è¦æ±‚

è´¨é‡æ ‡å‡†ï¼š
â”œâ”€ å‡†ç¡®æ€§ï¼šä¿æŒå­¦æœ¯æœ¯è¯­çš„å‡†ç¡®æ€§
â”œâ”€ æµç•…æ€§ï¼šç¬¦åˆä¸­æ–‡è¡¨è¾¾ä¹ æƒ¯
â”œâ”€ ä¸“ä¸šæ€§ï¼šä½¿ç”¨è§„èŒƒçš„å­¦æœ¯ç”¨è¯­
â”œâ”€ å®Œæ•´æ€§ï¼šæ‰€æœ‰è‹±æ–‡éƒ½è¦ç¿»è¯‘
â””â”€ ä¸€è‡´æ€§ï¼šæœ¯è¯­ç¿»è¯‘ä¿æŒä¸€è‡´

äºŒã€æœ¯è¯­å¯¹ç…§è¡¨

åŸºç¡€æœ¯è¯­ï¼š
â”œâ”€ accuracy â†’ å‡†ç¡®ç‡
â”œâ”€ loss function â†’ æŸå¤±å‡½æ•°
â”œâ”€ neural network â†’ ç¥ç»ç½‘ç»œ
â”œâ”€ attention mechanism â†’ æ³¨æ„åŠ›æœºåˆ¶
â”œâ”€ training â†’ è®­ç»ƒ
â”œâ”€ evaluation â†’ è¯„ä¼°
â”œâ”€ dataset â†’ æ•°æ®é›†
â”œâ”€ model â†’ æ¨¡å‹
â”œâ”€ performance â†’ æ€§èƒ½
â”œâ”€ transformer â†’ Transformerï¼ˆä¿æŒè‹±æ–‡ï¼‰
â”œâ”€ embedding â†’ åµŒå…¥
â”œâ”€ layer â†’ å±‚
â”œâ”€ parameter â†’ å‚æ•°
â””â”€ optimization â†’ ä¼˜åŒ–

æ–¹æ³•è®ºæœ¯è¯­ï¼š
â”œâ”€ self-attention â†’ è‡ªæ³¨æ„åŠ›
â”œâ”€ multi-head attention â†’ å¤šå¤´æ³¨æ„åŠ›
â”œâ”€ feed-forward â†’ å‰é¦ˆ
â”œâ”€ backpropagation â†’ åå‘ä¼ æ’­
â”œâ”€ gradient descent â†’ æ¢¯åº¦ä¸‹é™
â”œâ”€ learning rate â†’ å­¦ä¹ ç‡
â”œâ”€ batch size â†’ æ‰¹æ¬¡å¤§å°
â””â”€ epoch â†’ è½®æ¬¡

ä¸‰ã€æ•°å­¦å…¬å¼çš„ç¿»è¯‘

è§„åˆ™ï¼š
â”œâ”€ å…¬å¼æœ¬èº«ä¸ç¿»è¯‘ï¼ˆä¿æŒLaTeXï¼‰
â”œâ”€ å…¬å¼å‰åçš„è¯´æ˜æ–‡å­—è¦ç¿»è¯‘
â”œâ”€ å˜é‡å®šä¹‰è¦ç¿»è¯‘
â””â”€ å˜é‡ç¬¦å·ä¿æŒä¸å˜

ç¤ºä¾‹ï¼š
EN: "where x is the input vector"
ZH: "å…¶ä¸­ x æ˜¯è¾“å…¥å‘é‡"

å››ã€ç« èŠ‚æ ‡é¢˜ç¿»è¯‘

æ ‡é¢˜å¯¹ç…§ï¼š
â”œâ”€ Abstract â†’ æ‘˜è¦
â”œâ”€ Introduction â†’ å¼•è¨€
â”œâ”€ Related Work â†’ ç›¸å…³å·¥ä½œ
â”œâ”€ Methodology â†’ æ–¹æ³•è®º
â”œâ”€ Method â†’ æ–¹æ³•
â”œâ”€ Approach â†’ æ–¹æ³•
â”œâ”€ Experiments â†’ å®éªŒ
â”œâ”€ Results â†’ ç»“æœ
â”œâ”€ Discussion â†’ è®¨è®º
â”œâ”€ Conclusion â†’ ç»“è®º
â”œâ”€ Future Work â†’ æœªæ¥å·¥ä½œ
â””â”€ References â†’ å‚è€ƒæ–‡çŒ®

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šè¾“å‡ºæ ¼å¼è§„èŒƒ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä¸€ã€æ™®é€šæ®µè½ï¼ˆparagraphï¼‰

{
  "id": "block-p1-001",
  "type": "paragraph",
  "content": {
    "en": [
      {"type": "text", "content": "We train the model with "},
      {"type": "inline-math", "latex": "n = 1000"},
      {"type": "text", "content": " samples."}
    ],
    "zh": [
      {"type": "text", "content": "æˆ‘ä»¬ä½¿ç”¨ "},
      {"type": "inline-math", "latex": "n = 1000"},
      {"type": "text", "content": " ä¸ªæ ·æœ¬è®­ç»ƒæ¨¡å‹ã€‚"}
    ]
  }
}

äºŒã€ç« èŠ‚æ ‡é¢˜ï¼ˆheadingï¼‰

{
  "id": "block-p1-002",
  "type": "heading",
  "level": 1,
  "content": {
    "en": [{"type": "text", "content": "3 Methodology"}],
    "zh": [{"type": "text", "content": "3 æ–¹æ³•è®º"}]
  }
}

levelè¯´æ˜ï¼š
â”œâ”€ 1: ä¸»æ ‡é¢˜ï¼ˆIntroduction, Methodsç­‰ï¼‰
â”œâ”€ 2: äºŒçº§æ ‡é¢˜ï¼ˆ3.1 Model Architectureï¼‰
â””â”€ 3: ä¸‰çº§æ ‡é¢˜ï¼ˆ3.1.1 Attention Layerï¼‰

ä¸‰ã€è¡Œé—´å…¬å¼ï¼ˆmathï¼‰

{
  "id": "block-p2-005",
  "type": "math",
  "latex": "\\mathcal{L} = -\\sum_{i=1}^{N} y_i \\log(\\hat{y}_i)"
}

æ³¨æ„ï¼š
â”œâ”€ ä¸éœ€è¦ç¾å…ƒç¬¦å·
â”œâ”€ ä¸éœ€è¦ç¿»è¯‘
â”œâ”€ ä¿æŒLaTeXæ ¼å¼
â””â”€ æ³¨æ„è½¬ä¹‰å­—ç¬¦ï¼ˆ\\è€Œä¸æ˜¯\ï¼‰

å››ã€æœ‰åºåˆ—è¡¨ï¼ˆordered-listï¼‰

{
  "id": "block-p3-001",
  "type": "ordered-list",
  "items": [
    {
      "content": {
        "en": [
          {"type": "text", "content": "First item with "},
          {"type": "inline-math", "latex": "O(n^2)"},
          {"type": "text", "content": " complexity."}
        ],
        "zh": [
          {"type": "text", "content": "ç¬¬ä¸€é¡¹ï¼Œå¤æ‚åº¦ä¸º "},
          {"type": "inline-math", "latex": "O(n^2)"},
          {"type": "text", "content": "ã€‚"}
        ]
      }
    },
    {
      "content": {
        "en": [{"type": "text", "content": "Second item about memory usage."}],
        "zh": [{"type": "text", "content": "ç¬¬äºŒé¡¹å…³äºå†…å­˜ä½¿ç”¨ã€‚"}]
      }
    }
  ]
}

äº”ã€æ— åºåˆ—è¡¨ï¼ˆunordered-listï¼‰

{
  "id": "block-p3-002",
  "type": "unordered-list",
  "items": [
    {
      "content": {
        "en": [{"type": "text", "content": "High accuracy on benchmarks"}],
        "zh": [{"type": "text", "content": "åœ¨åŸºå‡†æµ‹è¯•ä¸Šçš„é«˜å‡†ç¡®ç‡"}]
      }
    }
  ]
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… ç¬¬å…«éƒ¨åˆ†ï¼šè§£ææµç¨‹æ£€æŸ¥æ¸…å•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç¬¬1æ­¥ï¼šåˆæ­¥æ‰«æ
â”œâ”€ æ£€æŸ¥æ˜¯å¦æœ‰"References"æ ‡é¢˜
â”œâ”€ å¦‚æœæœ‰ï¼Œæ ‡è®°ä½ç½®ï¼Œè¯¥ä½ç½®ä¹‹åçš„å†…å®¹å…¨éƒ¨è·³è¿‡
â””â”€ ç¡®å®šéœ€è¦å¤„ç†çš„æ–‡æœ¬èŒƒå›´

ç¬¬2æ­¥ï¼šå†…å®¹è¯†åˆ«
â”œâ”€ è¯†åˆ«ç« èŠ‚æ ‡é¢˜ï¼ˆç‹¬ç«‹æˆè¡Œï¼Œé€šå¸¸æœ‰ç¼–å·ï¼‰
â”œâ”€ è¯†åˆ«æ™®é€šæ®µè½
â”œâ”€ è¯†åˆ«åˆ—è¡¨ï¼ˆæ£€æŸ¥æ¢è¡Œ + ç¼–å·æ¨¡å¼ï¼‰
â”œâ”€ è¯†åˆ«è¡Œé—´å…¬å¼ï¼ˆç‹¬ç«‹æˆè¡Œ + å‰åæ¢è¡Œï¼‰
â””â”€ åœ¨æ®µè½ä¸­è¯†åˆ«è¡Œå†…å…¬å¼

ç¬¬3æ­¥ï¼šå†…å®¹è¿‡æ»¤
â”œâ”€ è·³è¿‡æ‰€æœ‰ç‹¬ç«‹çš„å›¾è¡¨é¢˜æ³¨
â”œâ”€ åˆ é™¤æ‰€æœ‰å¼•ç”¨æ ‡è®°[1]ã€[2-5]ç­‰
â”œâ”€ ä¿ç•™æ­£æ–‡ä¸­çš„å›¾è¡¨å¼•ç”¨
â””â”€ æ¸…ç†å¤šä½™ç©ºæ ¼

ç¬¬4æ­¥ï¼šç¿»è¯‘å¤„ç†
â”œâ”€ ç¿»è¯‘æ‰€æœ‰æ–‡æœ¬å†…å®¹
â”œâ”€ ä¿æŒæ•°å­¦å…¬å¼ä¸å˜
â”œâ”€ ç¡®ä¿æœ¯è¯­ç¿»è¯‘ä¸€è‡´
â””â”€ æ£€æŸ¥zhå’Œenç»“æ„å¯¹åº”

ç¬¬5æ­¥ï¼šæ ¼å¼è¾“å‡º
â”œâ”€ ç”Ÿæˆå”¯ä¸€IDï¼ˆblock-p{é¡µç }-{åºå·}ï¼‰
â”œâ”€ ç¡®å®šæ­£ç¡®çš„type
â”œâ”€ æ„å»ºcontentç»“æ„
â””â”€ éªŒè¯JSONæ ¼å¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ ç¬¬ä¹éƒ¨åˆ†ï¼šç‰¹åˆ«æ³¨æ„äº‹é¡¹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

åŠ¡å¿…åšåˆ°ï¼š
âœ“ åˆ—è¡¨è¯†åˆ«ï¼šå¿…é¡»æ£€æŸ¥æ¢è¡Œæ¨¡å¼ï¼Œä¸è¦è¯¯åˆ¤
âœ“ è¡Œé—´å…¬å¼ï¼šç‹¬ç«‹æˆè¡Œ + å‰åæ¢è¡Œæ‰æ˜¯è¡Œé—´å…¬å¼
âœ“ é¢˜æ³¨è·³è¿‡ï¼šç‹¬ç«‹çš„å›¾è¡¨é¢˜æ³¨å®Œå…¨ä¸è¾“å‡º
âœ“ å‚è€ƒæ–‡çŒ®ï¼šé‡åˆ°Referencesç« èŠ‚ç«‹å³åœæ­¢
âœ“ å¼•ç”¨åˆ é™¤ï¼š[1]ã€[2-5]ç­‰å…¨éƒ¨åˆ é™¤
âœ“ å®Œæ•´ç¿»è¯‘ï¼šæ‰€æœ‰è‹±æ–‡å†…å®¹å¿…é¡»ç¿»è¯‘
âœ“ ç»“æ„å¯¹åº”ï¼šenå’Œzhçš„contentç»“æ„å¿…é¡»ä¸€è‡´
âœ“ IDå”¯ä¸€ï¼šblock-p{é¡µç }-{åºå·}æ ¼å¼
âœ“ LaTeXå‡†ç¡®ï¼šæ³¨æ„è½¬ä¹‰ã€å¸Œè…Šå­—æ¯ã€ç‰¹æ®Šç¬¦å·

ç»å¯¹ä¸è¦ï¼š
âœ— ä¸è¦æŠŠæ­£æ–‡ä¸­çš„"Figure 1 shows"å½“ä½œé¢˜æ³¨
âœ— ä¸è¦æŠŠåŒè¡Œçš„ç¼–å·è¯†åˆ«ä¸ºåˆ—è¡¨
âœ— ä¸è¦æŠŠè¡Œå†…å…¬å¼è¯†åˆ«ä¸ºè¡Œé—´å…¬å¼
âœ— ä¸è¦è¾“å‡ºå›¾è¡¨é¢˜æ³¨
âœ— ä¸è¦å¤„ç†å‚è€ƒæ–‡çŒ®å†…å®¹
âœ— ä¸è¦é—æ¼ä¸­æ–‡ç¿»è¯‘
âœ— ä¸è¦åœ¨è¡Œé—´å…¬å¼å¤–åŠ ç¾å…ƒç¬¦å·
âœ— ä¸è¦ç ´åå¥å­çš„å®Œæ•´æ€§

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¤ ç¬¬åéƒ¨åˆ†ï¼šæœ€ç»ˆè¿”å›æ ¼å¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  "blocks": [
    // æ‰€æœ‰è§£æçš„å—ï¼ŒæŒ‰é¡ºåºæ’åˆ—
  ],
  "pageType": "content",  // æˆ– "references"
  "isPageStart": true,
  "isPageEnd": true,
  "lastBlockContinues": false
}

å®Œæˆè§£æåï¼Œè¯·è‡ªæˆ‘æ£€æŸ¥ï¼š
1. âœ“ æ˜¯å¦æ‰€æœ‰åˆ—è¡¨éƒ½æ­£ç¡®è¯†åˆ«äº†ï¼Ÿ
2. âœ“ æ˜¯å¦æ‰€æœ‰è¡Œé—´å…¬å¼éƒ½è¯†åˆ«äº†ï¼Ÿ
3. âœ“ æ˜¯å¦è·³è¿‡äº†æ‰€æœ‰å›¾è¡¨é¢˜æ³¨ï¼Ÿ
4. âœ“ æ˜¯å¦åˆ é™¤äº†æ‰€æœ‰å¼•ç”¨æ ‡è®°ï¼Ÿ
5. âœ“ æ˜¯å¦å®Œæ•´ç¿»è¯‘äº†æ‰€æœ‰å†…å®¹ï¼Ÿ
6. âœ“ æ˜¯å¦enå’Œzhç»“æ„ä¸€è‡´ï¼Ÿ
7. âœ“ æ˜¯å¦åœ¨é‡åˆ°Referencesååœæ­¢äº†ï¼Ÿ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
  }

  async extractAbstractAndKeywords(text: string): Promise<{
    abstract: { en?: string; zh?: string };
    keywords: string[];
  }> {
    const systemPrompt = `ä½ æ˜¯å­¦æœ¯è®ºæ–‡æ‘˜è¦æå–ä¸“å®¶ã€‚ä»è®ºæ–‡æ–‡æœ¬ä¸­ç²¾ç¡®æå–æ‘˜è¦å’Œå…³é”®è¯ï¼Œå¹¶ç¿»è¯‘æˆä¸­æ–‡ï¼Œä»¥ JSON æ ¼å¼è¿”å›ã€‚

æå–è§„åˆ™ï¼š

1. æ‘˜è¦ï¼ˆAbstractï¼‰ï¼š
   - æŸ¥æ‰¾"Abstract"æ ‡è®°ï¼ˆå¯èƒ½æ˜¯ABSTRACTå…¨å¤§å†™ï¼‰
   - æå–ä»"Abstract"ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œåˆ°ä¸‹ä¸€ä¸ªç« èŠ‚æ ‡é¢˜ä¹‹å‰çš„æ‰€æœ‰æ–‡å­—
   - æ‘˜è¦é€šå¸¸æ˜¯1-3ä¸ªå®Œæ•´æ®µè½
   - ä¸åŒ…å«"Abstract"æ ‡é¢˜æœ¬èº«
   - åˆ é™¤æ‰€æœ‰å¼•ç”¨æ ‡è®°å¦‚[1]ã€[2-5]ç­‰
   - ä¿ç•™æ‰€æœ‰æ•°å­¦å˜é‡å’Œå…¬å¼åŸæ ·ï¼ˆä¸éœ€è¦è½¬æ¢ä¸ºLaTeXï¼‰
   - å°†è‹±æ–‡æ‘˜è¦ç¿»è¯‘æˆä¸­æ–‡ï¼ˆå‡†ç¡®ã€æµç•…ã€ä¸“ä¸šï¼‰

2. å…³é”®è¯ï¼ˆKeywordsï¼‰ï¼š
   - æŸ¥æ‰¾"Keywords"ã€"Index Terms"ã€"Key words"ç­‰æ ‡è®°
   - æå–é€—å·æˆ–åˆ†å·åˆ†éš”çš„è¯æ±‡åˆ—è¡¨
   - é€šå¸¸3-8ä¸ªå…³é”®è¯
   - å»é™¤å¤šä½™ç©ºæ ¼ï¼Œä¿æŒåŸå§‹å¤§å°å†™
   - æ¯ä¸ªå…³é”®è¯é¦–å­—æ¯é€šå¸¸å¤§å†™

è¿”å› JSON æ ¼å¼ï¼š
{
  "abstract": {
    "en": "å®Œæ•´çš„è‹±æ–‡æ‘˜è¦ï¼Œå¤šæ®µè½ç”¨ä¸¤ä¸ªæ¢è¡Œåˆ†éš”ï¼Œåˆ é™¤äº†å¼•ç”¨æ ‡è®°",
    "zh": "å®Œæ•´çš„ä¸­æ–‡æ‘˜è¦ç¿»è¯‘ï¼Œä¿æŒæ®µè½ç»“æ„"
  },
  "keywords": ["Deep Learning", "Neural Networks", "Attention Mechanism"]
}

å¦‚æœæ‰¾ä¸åˆ°æ‘˜è¦æˆ–å…³é”®è¯ï¼Œå¯¹åº”å­—æ®µè¿”å›ç©ºå­—ç¬¦ä¸²æˆ–ç©ºæ•°ç»„ã€‚`;

    const userPrompt = `è¯·ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–æ‘˜è¦å’Œå…³é”®è¯ï¼Œå¹¶å°†æ‘˜è¦ç¿»è¯‘æˆä¸­æ–‡ï¼Œä»¥ JSON æ ¼å¼è¿”å›ï¼š

${text}`;

    try {
      const completion = await this.client.chat.completions.create({
        model: 'deepseek-chat',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: userPrompt }
        ],
        temperature: 0.1,
        max_tokens: 3000,
        response_format: { type: 'json_object' }
      });

      const content = completion.choices[0].message.content;
      if (!content) {
        throw new Error('LLMè¿”å›å†…å®¹ä¸ºç©º');
      }

      return JSON.parse(content);
    } catch (error) {
      console.error('æå–æ‘˜è¦å¤±è´¥:', error);
      return {
        abstract: { en: '', zh: '' },
        keywords: []
      };
    }
  }

  async extractReferences(text: string): Promise<any[]> {
    const systemPrompt = `ä½ æ˜¯å‚è€ƒæ–‡çŒ®è§£æä¸“å®¶ã€‚ä»å‚è€ƒæ–‡çŒ®åˆ—è¡¨ä¸­æå–æ‰€æœ‰å¼•ç”¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œè§£æä¸ºç»“æ„åŒ–çš„ JSON æ•°æ®ã€‚

è¯†åˆ«è§„åˆ™ï¼š

1. å‚è€ƒæ–‡çŒ®æ ¼å¼è¯†åˆ«ï¼š
   - ç¼–å·æ ¼å¼ï¼š[1]ã€1.ã€(1)ã€[1.]ç­‰
   - æ¯æ¡å¼•ç”¨é€šå¸¸ç‹¬ç«‹æˆè¡Œæˆ–ä»¥ç¼–å·å¼€å§‹
   - ç¼–å·é€šå¸¸æ˜¯è¿ç»­çš„æ•°å­—

2. å­—æ®µæå–è§„åˆ™ï¼š

   ã€ä½œè€…ï¼ˆauthorsï¼‰ã€‘ï¼š
   - ä½ç½®ï¼šé€šå¸¸åœ¨å¼•ç”¨çš„æœ€å‰é¢
   - æ ¼å¼ï¼šå§“, åé¦–å­—æ¯. æˆ– å§“ åé¦–å­—æ¯
   - å¤šä¸ªä½œè€…ç”¨é€—å·æˆ–"and"åˆ†éš”
   - ç¤ºä¾‹ï¼š["Vaswani, A.", "Shazeer, N.", "Parmar, N."]

   ã€æ ‡é¢˜ï¼ˆtitleï¼‰ã€‘ï¼š
   - ä½ç½®ï¼šé€šå¸¸åœ¨ä½œè€…ä¹‹å
   - æ ¼å¼ï¼šå¯èƒ½ç”¨å¼•å·åŒ…å›´ï¼Œæˆ–ä¸ºæ–œä½“
   - å®Œæ•´æå–ï¼Œä¿æŒåŸæ ‡é¢˜
   - ç¤ºä¾‹ï¼š"Attention is all you need"

   ã€å‡ºç‰ˆç‰©ï¼ˆpublicationï¼‰ã€‘ï¼š
   - æœŸåˆŠåã€ä¼šè®®åæˆ–å‡ºç‰ˆç¤¾
   - å¯èƒ½åŒ…å«ç¼©å†™ï¼ˆNeurIPS, ICML, arXivç­‰ï¼‰
   - ç¤ºä¾‹ï¼š"Advances in Neural Information Processing Systems"

   ã€å¹´ä»½ï¼ˆyearï¼‰ã€‘ï¼š
   - 4ä½æ•°å­—
   - é€šå¸¸åœ¨å‡ºç‰ˆç‰©ä¹‹åæˆ–æ‹¬å·ä¸­
   - è¿”å›æ•°å­—ç±»å‹
   - ç¤ºä¾‹ï¼š2017

   ã€DOIã€‘ï¼š
   - ä»¥"doi:"ã€"DOI:"ã€"https://doi.org/"å¼€å¤´
   - æ ¼å¼ï¼š10.xxxx/xxxxx
   - ç¤ºä¾‹ï¼š"10.1109/CVPR.2016.90"

   ã€URLã€‘ï¼š
   - å®Œæ•´çš„ç½‘å€
   - é€šå¸¸ä»¥http://æˆ–https://å¼€å¤´
   - ç¤ºä¾‹ï¼š"https://arxiv.org/abs/1706.03762"

   ã€é¡µç ï¼ˆpagesï¼‰ã€‘ï¼š
   - æ ¼å¼ï¼špp. 123-145 æˆ– pages 123-145
   - æå–æ•°å­—èŒƒå›´
   - ç¤ºä¾‹ï¼š"5998-6008"

   ã€å·å·ï¼ˆvolumeï¼‰ã€‘ï¼š
   - é€šå¸¸åœ¨æœŸåˆŠåä¹‹å
   - æ ¼å¼ï¼švol. X æˆ– Volume X
   - ç¤ºä¾‹ï¼š"30"

   ã€æœŸå·ï¼ˆissueï¼‰ã€‘ï¼š
   - é€šå¸¸åœ¨å·å·ä¹‹å
   - æ ¼å¼ï¼šno. X æˆ– (X)
   - ç¤ºä¾‹ï¼š"4"

3. æ”¯æŒçš„å¼•ç”¨æ ¼å¼ï¼š
   - IEEEï¼š[1] A. Author, "Title," Journal, vol. X, no. Y, pp. Z-Z, Year.
   - ACMï¼š[1] Author, A. Year. Title. In Conference (pp. Z-Z).
   - APAï¼šAuthor, A. (Year). Title. Journal, Volume(Issue), pages.
   - å…¶ä»–å¸¸è§å­¦æœ¯æ ¼å¼

è¿”å› JSON æ ¼å¼ï¼š
{
  "references": [
    {
      "id": "ref-1",
      "number": 1,
      "authors": ["Vaswani, A.", "Shazeer, N."],
      "title": "Attention is all you need",
      "publication": "Advances in Neural Information Processing Systems",
      "year": 2017,
      "pages": "5998-6008",
      "volume": null,
      "issue": null,
      "doi": null,
      "url": null
    }
  ]
}

æ³¨æ„äº‹é¡¹ï¼š
1. å°½å¯èƒ½å®Œæ•´åœ°æå–æ‰€æœ‰å­—æ®µ
2. ä½œè€…åä¿æŒåŸæ ¼å¼ï¼ˆä¸è¦ä¿®æ”¹ï¼‰
3. å¦‚æœæŸå­—æ®µæ‰¾ä¸åˆ°ï¼Œè®¾ä¸º null
4. ä¿æŒå¼•ç”¨ç¼–å·çš„è¿ç»­æ€§
5. yearå¿…é¡»æ˜¯æ•°å­—ç±»å‹
6. numberå¿…é¡»æ˜¯æ•°å­—ç±»å‹
7. è¿”å›æ ‡å‡† JSON æ ¼å¼ï¼Œç¡®ä¿æ‰€æœ‰å¼•å·æ­£ç¡®`;

    const userPrompt = `è¯·ä»ä»¥ä¸‹å‚è€ƒæ–‡çŒ®åˆ—è¡¨ä¸­æå–æ‰€æœ‰å¼•ç”¨çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚

å‚è€ƒæ–‡çŒ®åˆ—è¡¨ï¼š
${text}

è¿”å›åŒ…å«æ‰€æœ‰å¼•ç”¨çš„JSONæ•°æ®ã€‚`;

    try {
      const completion = await this.client.chat.completions.create({
        model: 'deepseek-chat',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: userPrompt }
        ],
        temperature: 0.1,
        max_tokens: 8000,
        response_format: { type: 'json_object' }
      });

      const content = completion.choices[0].message.content;
      if (!content) {
        throw new Error('LLMè¿”å›å†…å®¹ä¸ºç©º');
      }

      const result = JSON.parse(content);
      return result.references || [];
    } catch (error) {
      console.error('æå–å‚è€ƒæ–‡çŒ®å¤±è´¥:', error);
      return [];
    }
  }
}
# NeuInk 项目完整技术文档

## 一、项目概述

NeuInk 是一个基于 Electron + Next.js 的本地桌面应用，专门用于学术论文的阅读、管理和笔记记录。该应用采用 Monorepo 架构，将前端、后端和 Electron 主进程分离管理，实现了前后端分离的桌面应用开发模式。

### 核心特性

* **本地化存储**：所有数据存储在本地，保证隐私和数据安全
* **离线使用**：无需联网即可完整使用所有功能
* **跨平台**：支持 Windows、macOS、Linux
* **模块化设计**：前后端分离，易于维护和扩展
* **现代化UI**：基于 shadcn/ui 和 Tailwind CSS 的美观界面

---
---
---

## 三、技术栈

### 前端技术栈

* **Next.js 14+**：React 框架，使用 App Router
* **TypeScript**：类型安全的 JavaScript
* **shadcn/ui**：基于 Radix UI 的组件库
* **Tailwind CSS**：实用优先的 CSS 框架
* **Zustand**：轻量级状态管理
* **KaTeX**：数学公式渲染
* **react-markdown**：Markdown 内容渲染
* **Prism.js**：代码语法高亮
* **Lucide React**：图标库

### 后端技术栈

* **Node.js**：JavaScript 运行时
* **Express**：Web 框架
* **TypeScript**：类型安全开发
* **SQLite**：轻量级关系型数据库
* **FlexSearch**：全文搜索引擎（计划）

### 桌面端技术栈

* **Electron**：跨平台桌面应用框架
* **IPC 通信**：主进程与渲染进程通信

---

## 三、项目目录结构

```
neuink/
├── frontend/                          # Next.js 前端应用
│   ├── app/                          # Next.js App Router
│   │   ├── components/               # 组件目录
│   │   │   ├── layout/              # 布局组件
│   │   │   │   ├── Sidebar.tsx      # 左侧导航栏（计划）
│   │   │   │   ├── TabBar.tsx       # 标签页栏（计划）
│   │   │   │   └── MainLayout.tsx   # 主布局容器（计划）
│   │   │   └── ui/                  # shadcn/ui 组件
│   │   ├── lib/                     # 工具函数和配置
│   │   │   └── utils.ts             # 通用工具函数
│   │   ├── store/                   # Zustand 状态管理
│   │   │   ├── useTabStore.ts       # 标签页状态（计划）
│   │   │   ├── usePaperStore.ts     # 论文数据状态（计划）
│   │   │   └── useSettingsStore.ts  # 设置状态（计划）
│   │   ├── types/                   # TypeScript 类型定义
│   │   │   ├── paper.ts             # 论文相关类型（计划）
│   │   │   ├── checklist.ts         # 清单相关类型（计划）
│   │   │   └── note.ts              # 笔记相关类型（计划）
│   │   ├── layout.tsx               # 根布局
│   │   ├── page.tsx                 # 首页
│   │   └── globals.css              # 全局样式
│   ├── public/                      # 静态资源
│   │   └── assets/                  # 图片、图标等
│   ├── components/                  # shadcn/ui 生成的组件
│   │   └── ui/                      # UI 基础组件
│   ├── package.json                 # 前端依赖配置
│   ├── next.config.js               # Next.js 配置
│   ├── tailwind.config.ts           # Tailwind 配置
│   └── tsconfig.json                # TypeScript 配置
│
├── backend/                          # Node.js 后端服务
│   ├── src/                         # 源代码目录
│   │   ├── routes/                  # 路由定义
│   │   │   ├── papers.ts            # 论文相关路由（计划）
│   │   │   ├── checklists.ts        # 清单相关路由（计划）
│   │   │   ├── notes.ts             # 笔记相关路由（计划）
│   │   │   └── stats.ts             # 统计相关路由（计划）
│   │   ├── controllers/             # 业务逻辑控制器
│   │   │   ├── paperController.ts   # 论文操作（计划）
│   │   │   ├── checklistController.ts # 清单操作（计划）
│   │   │   └── noteController.ts    # 笔记操作（计划）
│   │   ├── models/                  # 数据模型
│   │   │   ├── Paper.ts             # 论文数据模型（计划）
│   │   │   ├── Checklist.ts         # 清单数据模型（计划）
│   │   │   └── Note.ts              # 笔记数据模型（计划）
│   │   ├── utils/                   # 工具函数
│   │   │   ├── database.ts          # 数据库初始化（计划）
│   │   │   ├── fileSystem.ts        # 文件系统操作（计划）
│   │   │   └── search.ts            # 搜索功能（计划）
│   │   └── index.ts                 # 服务入口文件
│   ├── database/                    # SQLite 数据库文件
│   ├── package.json                 # 后端依赖配置
│   ├── tsconfig.json                # TypeScript 配置
│   └── .env                         # 环境变量配置
│
├── electron/                         # Electron 主进程
│   ├── main.js                      # Electron 主进程入口
│   ├── preload.js                   # 预加载脚本
│   ├── package.json                 # Electron 依赖配置
│   └── assets/                      # 应用图标等资源（计划）
│
├── docs/                            # 项目文档
│   └── requirements.md              # 需求文档
│
├── .gitignore                       # Git 忽略配置
├── package.json                     # 根 package.json（脚本管理）
└── README.md                        # 项目说明文档
```

---

## 四、核心功能详细说明

### 4.1 月度统计（首页/Dashboard）

月度统计功能是应用的首页，为用户提供全面的阅读数据可视化和趋势分析。该功能旨在帮助用户了解自己的阅读习惯、进度和学术成果积累情况。

**时间维度统计**：系统会精确记录用户在每篇论文上的实际阅读时间，仅统计论文标签页处于激活状态（即用户正在查看）的时长。这确保了统计数据的准确性，避免将后台挂起的时间计入阅读时长。用户可以查看每日、每周和每月的阅读时长分布，通过折线图或柱状图的形式直观展示阅读时间的变化趋势。

**数量统计**：该模块会统计用户添加到库中的论文总数、已标记为"已读完"的论文数量，以及在特定时间段内新增的论文数量。这些数据帮助用户了解自己的论文积累速度和阅读完成率，从而更好地规划阅读计划。

**分类统计**：系统会自动按照不同维度对论文进行分类统计。按清单分类的统计可以展示用户在不同研究主题上的阅读分布，例如"深度学习"主题下阅读了多少篇论文。按文献类型的统计会区分期刊论文、会议论文、预印本等不同类型的文献数量。按学科领域统计可以展示用户跨学科的阅读广度。按SCI分区或CCF等级统计可以反映用户阅读论文的质量水平。

**趋势分析**：通过数据可视化组件（如 Recharts），系统会生成多种趋势图表。阅读时长趋势图展示用户在一段时间内的阅读投入变化，帮助用户发现自己的高效阅读时段。阅读数量趋势图展示论文阅读完成的节奏。阅读热力图采用日历视图，类似 GitHub 的贡献图，用颜色深浅表示每天的阅读活跃度，让用户一目了然地看到自己的阅读连续性。

**交互功能**：所有统计数据都是可交互的。用户点击某个统计项（例如"Q1期刊论文"），系统会自动跳转到论文库页面，并应用相应的筛选条件，显示所有符合该条件的论文列表。用户还可以自定义统计的时间范围，导出统计报告为 PDF 或 CSV 格式，便于学术汇报或个人记录。

---

### 4.2 论文库（Library）管理功能

论文库是应用的核心模块，负责管理用户的所有学术论文，提供添加、编辑、查看、搜索和组织论文的完整功能。

**论文添加流程**：用户可以通过点击"添加论文"按钮来创建新的论文记录。添加流程分为两个主要阶段：首先填写基本信息表单，然后使用可视化JSON编辑器构建论文的结构化内容。基本信息表单包括论文的元数据，如标题（英文和中文）、作者列表、发表日期、期刊或会议名称、DOI、文献类型、SCI分区、CCF等级、影响因子、摘要、关键词等详细字段。这些信息帮助系统对论文进行分类和检索。用户还可以上传PDF文件（可选），系统会将其保存到本地指定目录，并在论文记录中保存文件路径。

**可视化JSON编辑器**：这是论文添加功能的核心创新。编辑器采用三栏布局：左侧是组件面板和配置面板，中间是编辑区域，右侧是实时预览区域。左侧组件面板提供了丰富的内容元素，包括标题（H1-H6，带自动编号）、段落（支持引用角标）、图片/插图（含编号、标题、说明）、表格（含编号、标题）、数学公式（LaTeX格式，支持行内和块级）、引用标注（链接到参考文献）、有序和无序列表、代码块（支持语法高亮）、引用块、超链接、脚注、分隔符、参考文献列表和附录等。

用户通过拖拽的方式将组件添加到中间的编辑区域，点击每个组件可以在左侧显示其属性配置面板。例如，添加图片组件后，用户可以上传图片文件，系统自动保存到后端，并允许用户设置图片编号（如 Figure 1）、图片标题、详细说明文字以及显示尺寸。对于表格组件，用户可以设置行列数、表格编号（如 Table 1）、标题、说明，并逐个编辑单元格内容。数学公式组件支持LaTeX语法输入，用户可以选择行内模式或块级模式，系统使用KaTeX进行实时渲染预览。

编辑器支持组件的拖拽排序、复制、删除操作，提供撤销/重做功能，并实时在右侧预览区域渲染最终效果。用户完成编辑后，点击保存按钮，系统将内容结构化为JSON格式存储到后端。编辑器还预留了"导入"按钮，未来可以支持从外部工具（如Zotero、Mendeley）导入论文JSON数据。

**论文列表展示**：论文库页面提供三种视图模式供用户切换。列表视图以紧凑的行式布局显示论文，每行包含标题、作者、年份、阅读状态等关键信息，适合快速浏览。网格视图采用卡片式布局，每个论文显示为一个卡片，包含缩略图（如论文首图）、标题和关键信息，视觉效果更丰富。表格视图以详细的表格形式展示论文，可以显示更多字段（如DOI、引用次数、影响因子等），适合需要对比多个论文信息的场景。

**排序和筛选功能**：用户可以按照多种维度对论文列表进行排序，包括标题字母顺序（A-Z或Z-A）、作者、发表日期、添加时间、最后阅读时间、阅读状态、个人评分、引用次数和影响因子。筛选功能允许用户按文献类型（期刊/会议/预印本等）、SCI或CCF分级、阅读状态（未读/阅读中/已读）、自定义标签、年份范围、所属清单和优先级进行多条件组合筛选，快速定位需要的论文。

**全文搜索功能**：论文库集成了强大的全文搜索引擎（FlexSearch），支持在论文标题、作者、摘要、关键词和正文内容中搜索关键词。搜索结果会高亮显示匹配的关键词，并展示上下文片段，帮助用户快速判断相关性。搜索结果按相关度排序，用户点击搜索结果可以直接跳转到对应论文的具体位置。系统还会保存搜索历史记录，方便用户重复使用常用搜索条件。

**批量操作功能**：用户可以勾选多篇论文进行批量操作，包括批量添加到某个清单、批量标记阅读状态、批量添加标签以及批量删除。这大大提高了论文管理的效率，特别是在处理大量论文时。

---

### 4.3 论文阅读功能

论文阅读功能是应用的最核心模块，提供沉浸式的论文阅读体验和强大的交互功能。

**阅读界面布局**：阅读页面采用三栏布局设计。左侧是论文大纲/目录面板，自动根据论文中的标题层级生成目录树，用户点击目录项可以快速跳转到对应章节。左侧面板可折叠，为阅读区域留出更多空间。中间是论文内容主体区域，占据大部分屏幕空间，展示论文的完整内容。右侧是笔记面板，用户可以在此查看和编辑与当前阅读内容相关的笔记，该面板同样可折叠。

**顶部工具栏**：工具栏提供多种快捷功能。显示模式切换按钮允许用户在"仅英文"、"仅中文"和"中英对照"三种模式间切换。字体大小调整按钮方便用户根据自己的视力习惯调整文字大小。阅读进度百分比实时显示当前阅读位置占全文的百分比。"标记读完"按钮让用户手动标记论文为已读状态。"添加到清单"按钮快速将当前论文归类到某个研究清单中。

**内容展示**：阅读页面顶部首先展示论文的基本信息区，包括论文标题、作者列表、期刊或会议信息、发表年份、SCI/CCF分级标识、用户的个人评分、自定义标签列表。摘要和关键词默认展示在信息区，用户可以折叠以节省空间。

正文内容从JSON结构解析渲染，系统支持渲染所有在JSON编辑器中创建的元素类型。文本段落保留原有格式，标题带有自动编号（如"1. Introduction"），列表按有序或无序类型渲染。代码块使用Prism.js进行语法高亮，支持多种编程语言。数学公式使用KaTeX渲染，确保公式显示清晰准确。

图片元素会显示图片编号、标题和说明，用户点击图片可以放大查看高清版本。表格元素显示表格编号、标题和说明，对于宽度较大的表格，系统提供横向滚动功能。引用标注以上标形式显示（如\[1]），鼠标悬停时显示悬浮卡片，预览该引用文献的作者、年份和标题，点击引用标注可以跳转到页面底部的参考文献列表对应位置。脚注以上标形式显示，鼠标悬停显示脚注内容。超链接可点击跳转，外部链接会在新窗口打开。

**显示模式**：系统支持三种显示模式以满足不同用户的需求。"仅英文原文"模式只显示JSON中存储的英文内容，适合英文阅读能力较强的用户。"仅中文翻译"模式只显示预先翻译并存储在JSON中的中文内容，适合快速理解论文大意。"中英对照"模式同时显示英文和中文，用户可以在设置中选择上下对照（英文在上，中文在下）或左右对照（英文在左，中文在右）。中英对照模式特别适合学习专业英语和深入理解复杂概念。

**阅读进度管理**：系统会自动记录用户在每篇论文中的阅读位置（滚动位置百分比），当用户下次打开同一篇论文时，自动跳转到上次阅读的位置，无需重新查找。系统仅统计论文标签页处于激活状态的时长，实时累计阅读时长并保存到论文记录中，确保统计数据的准确性。当用户滚动到论文底部并停留一定时间后，系统会弹出提示询问是否标记为"已读"，用户也可以随时通过工具栏的"标记读完"按钮手动标记，标记后论文的阅读状态会更新为"已读"。

**交互功能**：论文内容支持丰富的交互操作。用户鼠标悬停在JSON结构的块级元素（如段落、图表）上时，该元素会显示边框高亮提示，便于用户识别内容块的边界。悬停在引用标注上时，显示该引用的悬浮预览卡片。悬停在脚注上时，显示脚注的完整内容。悬停在图片上时，显示图片的完整说明文字。

用户选中任意文本内容后右键点击,会弹出上下文菜单，提供"添加笔记"（将选中内容关联一条笔记）、"复制"、"AI解释"（调用配置的大模型API对选中内容进行解释）、"添加到清单"和"搜索相关内容"等功能。

用户左键点击内容块时，右侧笔记面板会自动切换到该内容块，显示该块所有关联的笔记。点击引用标注会跳转到参考文献列表的对应位置，并高亮显示该引用。点击图片或表格编号会在左侧大纲中高亮对应项。

**编辑功能**：虽然主要是阅读模式，但用户在阅读过程中如果发现需要修正内容，可以点击工具栏的"编辑"按钮进入编辑模式。编辑模式允许用户修改文字内容、替换图片、编辑表格内容等。编辑完成后保存，系统会更新论文的JSON文件。为了防止误操作，系统保留编辑历史记录，用户可以回退到之前的版本。

**块级笔记系统**：块级笔记是论文阅读功能的重要组成部分。用户可以为论文中的任何内容块（段落、图表、公式等）添加笔记。创建笔记时，用户选中内容块后右键选择"添加笔记"，或者点击内容块后在右侧笔记面板点击"添加笔记"按钮。笔记内容支持Markdown语法，可以插入代码块、图片、链接和LaTeX公式，提供丰富的表达能力。

同一个内容块可以添加多条笔记，每条笔记记录创建时间和最后修改时间。用户可以为笔记添加标签（如"重要"、"疑问"、"创新点"等），便于分类和检索。笔记支持全文搜索，用户可以在所有笔记中搜索关键词。笔记可以导出为Markdown文件，方便用户在其他应用中使用。

笔记显示在右侧笔记面板中，用户可以选择按创建时间或修改时间排序。笔记列表支持折叠和展开，节省屏幕空间。用户点击某条笔记时，系统会高亮显示该笔记关联的内容块，建立笔记与内容的双向关联。

---

### 4.4 清单管理功能

清单管理功能为用户提供了灵活的论文分类和组织方式，支持多级分类和自定义笔记模板。

**清单结构**：清单系统支持三级分类结构，满足从宏观到微观的分类需求。例如，用户可以创建"深度学习"作为一级清单，在其下创建"时间序列"作为二级清单，再在"时间序列"下创建"数据清洗"和"异常检测"等三级清单。这种层级结构允许用户根据自己的研究领域和知识体系灵活组织论文。

**清单显示位置**：清单在左侧导航菜单中显示，点击"清单管理"按钮下方会展开所有清单的树形结构。用户可以折叠或展开各级目录，快速定位到目标清单。清单支持拖拽调整顺序，用户可以根据使用频率或重要程度重新排列清单。

**清单管理页面**：点击导航菜单中的"清单管理"按钮会在新标签页中打开清单管理页面。该页面以树形结构展示所有清单，并提供创建、编辑和删除清单的功能。创建清单时，用户输入清单名称，选择父级清单（如果要创建子清单），并可选配置笔记模板。编辑清单时，用户可以修改清单名称、调整清单在层级结构中的位置、编辑笔记模板。删除清单时，系统会提示用户是否删除该清单关联的所有清单笔记，但清单中的论文本身不会被删除，只是移除了与该清单的关联关系。

**清单视图**：点击某个清单名称，系统会显示该清单中包含的所有论文。清单视图支持与论文库类似的排序、筛选和搜索功能。用户可以通过拖拽的方式将论文从论文库拖放到左侧清单，或者在论文列表中右键选择"添加到清单"，也可以在论文阅读页面通过工具栏的"添加到清单"按钮快速归类。一篇论文可以同时存在于多个清单中，这符合学术研究中论文可能涉及多个主题的实际情况。

**清单笔记功能**：清单笔记是一种特殊类型的笔记，用于描述论文在特定清单（研究主题）背景下的意义和价值。例如，同一篇论文在"数据清洗"清单中的笔记可能关注其清洗方法，而在"异常检测"清单中的笔记可能关注其检测算法。

**清单笔记创建流程**：用户首先创建清单（如"深度学习 → 时间序列 → 数据清洗"），然后将论文添加到该清单，最后在论文详情页或清单视图中为该论文在该清单下创建笔记。清单笔记的创建可以基于预定义的笔记模板，也可以自由编辑。

**笔记模板功能**：每个清单可以配置专属的笔记模板，模板定义了该清单下论文笔记应该包含的字段。例如，"数据清洗"清单的模板可能包含"使用的方法"、"处理的问题"、"数据集信息"、"效果评估"等字段。"异常检测"清单的模板可能包含"检测方法"、"特征工程"、"评估指标"、"创新点"等字段。当用户为论文创建清单笔记时，系统自动应用该清单的模板，用户填写各个字段内容。模板可以自定义修改，支持文本、文本域、选择框等多种字段类型。

**笔记组织**：清单笔记按清单路径分类存储在论文的JSON文件中。在论文详情页，用户可以看到该论文在所有清单下的笔记，按清单分组显示。用户可以快速切换查看不同清单的笔记，对比论文在不同研究主题下的应用和价值。清单笔记支持编辑和删除操作，当从清单中移除论文时，用户可以选择是否保留该清单的笔记。

**笔记展示位置**：在论文阅读页面的右侧笔记面板中，提供"块级笔记"和"清单笔记"两个标签页。用户可以切换标签页查看不同类型的笔记。在清单管理页面中，点击某个论文可以查看和编辑该清单的笔记。

**笔记与论文关联**：清单笔记保存在论文JSON文件的专门字段中（如`checklist_notes`），删除论文时自动删除所有关联的清单笔记。这确保了数据的一致性。

**块级笔记与清单笔记的区别**：块级笔记针对论文的具体内容块（如某个段落、某张图表、某个公式），用于记录对具体内容的理解、疑问或扩展思考。清单笔记针对论文在特定研究主题（清单）下的整体理解，用于记录论文的研究方法、数据集、效果、创新点等宏观信息。两种笔记相辅相成，满足不同层次的笔记需求。

---

### 4.5 全局搜索功能

全局搜索功能是应用的重要辅助工具,帮助用户快速定位所需信息。

**搜索入口**：顶部导航栏提供全局搜索框，用户可以通过快捷键（Ctrl/Cmd + F）快速聚焦搜索框。论文库页面和清单页面也提供各自的搜索框，搜索范围限定在当前页面显示的论文。

**搜索范围**：全局搜索支持在以下内容中检索关键词：论文标题、作者列表、摘要、关键词、论文正文的所有文本块（段落、表格、图表标题等）、所有块级笔记内容、所有清单笔记内容、自定义标签。这确保了即使用户忘记了论文的具体标题，也能通过内容片段或笔记内容找到对应论文。

**搜索功能**：系统提供实时搜索，用户输入关键词时实时显示搜索结果，无需按回车键。高级搜索功能允许用户指定搜索字段（仅在标题中搜索、仅在作者中搜索等）、按时间范围筛选（如2023年发表的论文）、按清单筛选（如仅在"深度学习"清单中搜索）、组合多个条件进行精确搜索。

**搜索结果**：搜索结果列表显示匹配的论文或笔记，关键词高亮显示。每个搜索结果显示上下文片段，帮助用户判断相关性。搜索结果按相关度排序，相关度算法考虑关键词在标题、摘要、正文中的位置和频率。用户点击搜索结果可以直接跳转到对应论文的具体位置，如果匹配的是某个内容块或笔记，跳转后会高亮显示该内容。

**搜索历史**：系统保存用户最近的搜索记录，用户可以快速重复之前的搜索操作。搜索历史记录可以清除。

---

### 4.6 设置功能

设置功能为用户提供个性化配置选项，优化使用体验。

**外观设置**：主题配置支持亮色主题、暗色主题和自动切换（跟随系统设置）。字体设置允许用户调整默认字体大小（如14px、16px、18px）、选择字体系列（如宋体、微软雅黑、思源黑体等）、调整行间距（如1.5倍、1.8倍、2倍）和段落间距。阅读偏好设置包括默认显示模式（英文/中文/对照）、中英对照方式（上下对照/左右对照）、代码块语法高亮主题（如VS Code、Monokai等）、数学公式渲染配置。

**大模型API配置**：用户可以配置接入的AI大模型API，用于论文内容的AI解释、翻译、总结等功能。API配置包括选择API提供商（OpenAI、Anthropic、本地模型等）、输入API Key（加密存储）、设置API Base URL、选择具体模型（如GPT-4、Claude 3.5 Sonnet等）。提示词模板允许用户自定义AI解释、翻译、总结等功能的提示词，适应不同的使用场景。

**数据管理**：数据存储位置显示当前数据存储的文件夹路径，用户可以修改该路径。数据备份功能支持手动备份（一键导出所有数据为ZIP文件）和自动备份（设置备份频率如每日、每周，保留的备份数量）。数据恢复功能允许用户从备份文件恢复数据。数据导出支持将所有数据导出为ZIP压缩包、将论文库导出为JSON格式、将笔记导出为Markdown格式。数据导入功能预留，未来可以支持从其他论文管理工具导入数据。

**其他设置**：快捷键配置允许用户自定义常用功能的快捷键（如新建论文、全局搜索、切换显示模式等）。语言设置用于选择界面语言（如简体中文、英文）。更新设置包括自动检查更新开关和更新通知方式。关于页面显示应用版本信息、开源许可证、反馈与支持链接等。

---

## 五、架构详细说明

### 5.1 前端架构（Frontend）

**技术选型理由**：

* **Next.js 14+**：选择Next.js是因为它提供了优秀的开发体验和性能优化。虽然NeuInk是桌面应用，但使用Next.js的App Router可以实现清晰的路由管理和代码分割，同时Next.js的服务端组件（Server Components）特性可以在未来需要时轻松扩展为云同步功能。
* **shadcn/ui + Radix UI**：shadcn/ui不是传统的组件库，而是一组可复制的组件代码，基于Radix UI构建。这种方式给了开发者完全的控制权，可以轻松定制样式和行为，同时Radix UI保证了无障碍访问（Accessibility）和键盘导航支持。
* **Tailwind CSS**：Tailwind的实用优先（Utility-first）方法大大加速了UI开发速度，避免了为每个组件编写自定义CSS的麻烦。
* **Zustand**：相比Redux，Zustand更轻量、API更简洁，非常适合中小型应用的状态管理。

**目录结构详解**：

`app/` 目录采用Next.js的App Router结构：

* `app/layout.tsx`：根布局组件，定义全局HTML结构、引入全局样式、配置字体等。
* `app/page.tsx`：应用首页（月度统计页面）。
* `app/components/layout/`：存放布局相关组件，如Sidebar（左侧导航栏）、TabBar（标签页栏）、MainLayout（主布局容器）。
* `app/components/ui/`：shadcn/ui生成的基础UI组件（按钮、输入框、对话框等）。
* `app/lib/`：工具函数库，如日期格式化、文件大小格式化、API请求封装等。
* `app/store/`：Zustand状态管理，按功能模块划分：

  * `useTabStore.ts`：管理标签页状态（打开的标签页列表、当前激活的标签页等）
  * `usePaperStore.ts`：管理论文数据（论文列表、当前查看的论文、筛选条件等）
  * `useSettingsStore.ts`：管理用户设置（主题、字体、API配置等）
* `app/types/`：TypeScript类型定义，确保类型安全：

  * `paper.ts`：定义Paper、Author、Figure、Table等类型
  * `checklist.ts`：定义Checklist、ChecklistNote等类型
  * `note.ts`：定义BlockNote、NoteTag等类型

**数据流**：

1. 用户交互触发事件（如点击"添加论文"按钮）
2. 组件调用Zustand store的action方法
3. Action方法通过API请求（fetch）与后端通信
4. 后端返回数据后，更新store中的状态
5. 组件订阅store的状态变化，自动重新渲染

**关键设计模式**：

* **组件化**：所有UI元素都封装为可复用的React组件
* **状态提升**：共享状态（如当前论文、标签页列表）提升到Zustand store中
* **受控组件**：表单输入等组件状态由React state控制，确保单向数据流
* **懒加载**：大型组件（如PDF查看器）使用动态导入（`next/dynamic`）实现按需加载

---

### 5.2 后端架构（Backend）

**技术选型理由**：

* **Express**：成熟稳定的Node.js Web框架，API简洁，中间件生态丰富。
* **TypeScript**：类型安全减少运行时错误，提升代码质量和可维护性。
* **SQLite**：轻量级嵌入式数据库，无需独立数据库服务，数据存储为单个文件，便于备份和迁移。适合本地应用的数据存储需求。

**目录结构详解**：

`src/` 目录采用MVC分层架构：

* `src/index.ts`：应用入口，初始化Express服务器，注册中间件和路由。
* `src/routes/`：路由层，定义API端点：

  * `papers.ts`：论文相关路由（GET /api/papers, POST /api/papers, PUT /api/papers/\:id, DELETE /api/papers/\:id等）
  * `checklists.ts`：清单相关路由
  * `notes.ts`：笔记相关路由
  * `stats.ts`：统计相关路由
* `src/controllers/`：控制器层，处理业务逻辑：

  * `paperController.ts`：包含getAllPapers、getPaperById、createPaper、updatePaper、deletePaper等方法
  * 控制器负责验证请求参数、调用模型层方法、返回响应
* `src/models/`：模型层，封装数据访问：

  * `Paper.ts`：定义Paper类，包含数据库CRUD方法（如`Paper.findAll()`, `Paper.findById()`, `Paper.create()`, `Paper.update()`, `Paper.delete()`）
  * 模型层直接与SQLite数据库交互
* `src/utils/`：工具函数：

  * `database.ts`：数据库初始化、连接管理
  * `fileSystem.ts`：文件系统操作（保存/读取JSON文件、上传图片等）
  * `search.ts`：全文搜索功能实现（基于FlexSearch）

`database/` 目录存储SQLite数据库文件（如`neuink.db`）。

**数据存储策略**：

NeuInk采用混合存储策略：

1. **SQLite数据库**：存储论文元数据（标题、作者、年份、阅读状态、标签等）和统计数据（阅读时长、进度等）。SQLite提供高效的查询和索引功能，适合结构化数据。
2. **JSON文件**：存储论文的完整内容（sections数组、references数组、notes对象等）。JSON文件存储在文件系统的指定目录（如`data/papers/`），文件名为论文ID（如`paper-12345.json`）。这种设计的优势：

   * 内容可读性强，便于调试和手动修改
   * 避免数据库存储大量文本数据导致性能问题
   * 便于版本控制和备份
   * 支持未来从外部工具导入JSON数据

**API设计**：

后端采用RESTful API设计：

* `GET /api/papers`：获取论文列表（支持分页、排序、筛选）
* `GET /api/papers/:id`：获取单篇论文详情
* `POST /api/papers`：创建新论文
* `PUT /api/papers/:id`：更新论文信息
* `DELETE /api/papers/:id`：删除论文
* `GET /api/papers/:id/content`：获取论文完整内容（读取JSON文件）
* `PUT /api/papers/:id/content`：更新论文内容（写入JSON文件）
* `POST /api/papers/:id/notes`：为论文添加笔记
* `GET /api/checklists`：获取清单列表
* `POST /api/checklists`：创建清单
* `GET /api/stats/reading-time`：获取阅读时长统计
* `GET /api/stats/paper-count`：获取论文数量统计

**中间件**：

* `cors`：处理跨域请求（前端在localhost:3000，后端在localhost:3001）
* `body-parser`：解析请求体（JSON和URL编码）
* `errorHandler`（自定义）：统一错误处理和日志记录

**数据库表结构**（SQLite）：

```sql
-- 论文表
CREATE TABLE papers (
  id TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  short_title TEXT,
  authors TEXT,  -- JSON数组字符串
  publication TEXT,
  year INTEGER,
  date TEXT,
  doi TEXT,
  article_type TEXT,
  sci_quartile TEXT,
  ccf_rank TEXT,
  tags TEXT,  -- JSON数组字符串
  reading_status TEXT,
  priority TEXT,
  rating INTEGER,
  reading_position REAL,
  total_reading_time INTEGER,
  last_read_time TEXT,
  created_at TEXT,
  updated_at TEXT
);

-- 清单表
CREATE TABLE checklists (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  full_path TEXT NOT NULL,
  parent_id TEXT,
  level INTEGER,
  note_template TEXT,  -- JSON字符串
  created_at TEXT,
  updated_at TEXT,
  FOREIGN KEY (parent_id) REFERENCES checklists(id)
);

-- 论文-清单关联表
CREATE TABLE paper_checklists (
  paper_id TEXT,
  checklist_id TEXT,
  PRIMARY KEY (paper_id, checklist_id),
  FOREIGN KEY (paper_id) REFERENCES papers(id),
  FOREIGN KEY (checklist_id) REFERENCES checklists(id)
);

-- 统计表
CREATE TABLE reading_stats (
  id TEXT PRIMARY KEY,
  paper_id TEXT,
  date TEXT,
  reading_time INTEGER,
  FOREIGN KEY (paper_id) REFERENCES papers(id)
);
```

---

### 5.3 Electron主进程架构

**功能职责**：

Electron主进程负责：

1. 创建和管理浏览器窗口（BrowserWindow）
2. 处理应用生命周期事件（启动、退出、激活）
3. 提供原生功能（文件对话框、系统托盘、菜单栏等）
4. 通过IPC（Inter-Process Communication）与渲染进程（前端）通信

**main.js详解**：

```javascript
const { app, BrowserWindow } = require('electron');
const path = require('path');

let mainWindow;

function createWindow() {
  // 创建浏览器窗口
  mainWindow = new BrowserWindow({
    width: 1400,
    height: 900,
    webPreferences: {
      nodeIntegration: false,      // 禁用Node集成，提升安全性
      contextIsolation: true,       // 启用上下文隔离
      preload: path.join(__dirname, 'preload.js')  // 预加载脚本
    },
    titleBarStyle: 'default',
    autoHideMenuBar: true          // 自动隐藏菜单栏
  });

  // 根据环境加载不同内容
  const isDev = process.env.NODE_ENV === 'development';
  
  if (isDev) {
    // 开发环境：加载Next.js dev server
    mainWindow.loadURL('http://localhost:3000');
    mainWindow.webContents.openDevTools();  // 打开开发者工具
  } else {
    // 生产环境：加载打包后的静态文件
    mainWindow.loadFile(path.join(__dirname, '../frontend/out/index.html'));
  }

  mainWindow.on('closed', () => {
    mainWindow = null;
  });
}

// 当Electron完成初始化后创建窗口
app.whenReady().then(() => {
  createWindow();

  // macOS特定：点击Dock图标时重新创建窗口
  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) {
      createWindow();
    }
  });
});

// 所有窗口关闭时退出应用（macOS除外）
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});
```

**preload.js详解**：

预加载脚本在渲染进程加载前执行，用于安全地向渲染进程暴露API：

```javascript
const { contextBridge } = require('electron');

// 使用contextBridge安全地暴露API
contextBridge.exposeInMainWorld('electronAPI', {
  platform: process.platform,          // 操作系统平台
  version: process.versions.electron,  // Electron版本
  // 未来可以添加更多API，如：
  // openFile: () => ipcRenderer.invoke('dialog:open
```
